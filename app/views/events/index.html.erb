<h1>All Events</h1>


<div id="event-details-map"></div>

<div class="news-feed">
  <% if @user_appealing_events %>
    <% @user_appealing_events.each do |event| %>

      <div class="appealing-event">
        <p class="appealing-event-name"><strong><%= event[0].capitalize %></strong></p>
        <p class="appealing-event-join">Join button</p>
        <p class="appealing-event-address"><%= event[4] %></p>
        <!-- Format date time before printing -->
        <p class="appealing-event-time"><%= event[5] %></p>
      </div>
    <% end %>
  <% end %>
</div>




<script>
  var events = <%= raw @user_appealing_events.as_json %>
  var currentLocation = <%= raw @current_location.as_json %>

  // JS for producing google map with marker
  function initMap() {

    var map = new google.maps.Map(document.getElementById('event-details-map'), {
      zoom: 11,
      center: {lat: currentLocation[0], lng: currentLocation[1]}
    });

    setMarkers(map);
  };

  function setMarkers(map) {
    var image = {
      url: 'http://b.fastcompany.net/asset_files/-/2014/11/13/poop.png',
      size: new google.maps.Size(26, 26),
      origin: new google.maps.Point(0, 0),
      anchor: new google.maps.Point(0, 26)
    };

    var shape = {
      coords: [1, 1, 1, 20, 18, 20, 18, 1],
      type: 'poly'
    };

    var infoWindow = new google.maps.InfoWindow({
      content: contentString,
      maxWidth: 200
    });

    for (var i = 0; i < events.length; i++) {
      var event = events[i]
      var contentString = event[0];

      var marker = new google.maps.Marker({
        position: {lat: event[1], lng: event[2]},
        map: map,
        icon: image,
        shape: shape,
        title: event[0],
        zIndex: event[3],
        info: contentString
      });

      google.maps.event.addListener(marker, 'click', function() {
        infoWindow.setContent(this.info);
        infoWindow.open(map, this);
      });
    };
  }

</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAvBDiolWNKT2Nn0wteaKxxKPQbk8ocjI&callback=initMap">
</script>

